{% extends "base.html" %}

{% block title %}Starta förhör{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/quiz_settings.css') }}">
{% endblock %}

{% block content %}
<div class="quiz-settings-page">

    <!-- HEADER -->
    <div class="quiz-settings-header">
        <h1>Starta nytt förhör</h1>
        <p>Välj ordlistor, riktning och antal ord.</p>
    </div>

    <form method="POST" class="quiz-settings-card">

        <div class="quiz-settings-grid">

            <!-- ================= LEFT: WORDLISTS ================= -->
            <section class="quiz-settings-section">

                <h3 class="section-title">Välj ordlistor</h3>

                <!-- Alla listor -->
                <label class="selectable-card">
                    <input type="checkbox" name="lists" value="all" id="all_lists" checked>
                    <span class="selectable-checkmark"></span>
                    <span class="selectable-text">Alla ordlistor</span>
                </label>

                <!-- Listor -->
                <div id="wordlist-wrapper" class="wordlist-wrapper">

                    {% for wl in wordlists %}
                    <label class="selectable-card single-list {% if loop.index > 4 %}hidden-list{% endif %}">
                        <input type="checkbox" class="single-list-input" name="lists" value="{{ wl.id }}">
                        <span class="selectable-checkmark"></span>
                        <span class="selectable-text">
                            {{ wl.name | short_label(28) }}
                            <span class="text-muted">({{ wl.words|length }} ord)</span>
                        </span>
                    </label>
                    {% endfor %}

                </div>

                <button type="button" id="toggle-lists-btn" class="btn-ghost">
                    Visa fler listor
                </button>

            </section>

            <!-- ================= RIGHT: DIRECTION ================= -->
            <section class="quiz-settings-section">

                <h3 class="section-title">Riktning</h3>

                <label class="selectable-card">
                    <input type="radio" name="direction" value="mix" checked>
                    <span class="selectable-checkmark"></span>
                    <span class="selectable-text">Blandat</span>
                </label>

                <label class="selectable-card">
                    <input type="radio" name="direction" value="sv_en">
                    <span class="selectable-checkmark"></span>
                    <span class="selectable-text">Svenska → Engelska</span>
                </label>

                <label class="selectable-card">
                    <input type="radio" name="direction" value="en_sv">
                    <span class="selectable-checkmark"></span>
                    <span class="selectable-text">Engelska → Svenska</span>
                </label>

            </section>

        </div>

        <!-- ================= SLIDER ================= -->
        <section class="quiz-settings-section">
            <h3 class="section-title">Antal ord</h3>

            <div class="slider-wrapper">
                <input
                    type="range"
                    name="num_words"
                    min="3"
                    max="21"
                    value="15"
                    id="num_words_slider"
                    oninput="num_words_output.textContent = this.value"
                >
                <span id="num_words_output" class="slider-value">15</span>
            </div>
        </section>

        <!-- ACTION -->
        <button type="submit" class="btn-primary btn-full">
            Starta förhör
        </button>

    </form>

</div>
{% endblock %}

{% block scripts %}
<script>
window.addEventListener("load", () => {

    const wrapper = document.getElementById("wordlist-wrapper");
    const toggleBtn = document.getElementById("toggle-lists-btn");
    const hiddenLists = document.querySelectorAll(".hidden-list");
    const allLists = document.getElementById("all_lists");
    const singleLists = document.querySelectorAll(".single-list-input");

    /* SHOW MORE / LESS */
    let expanded = false;

    toggleBtn.addEventListener("click", () => {
        expanded = !expanded;
        hiddenLists.forEach(el => el.classList.toggle("show"));
        toggleBtn.textContent = expanded ? "Visa färre listor" : "Visa fler listor";
    });

    /* ALL LISTS LOGIC */
    allLists.addEventListener("change", () => {
        if (allLists.checked) {
            singleLists.forEach(cb => cb.checked = false);
        }
    });

    singleLists.forEach(cb => {
        cb.addEventListener("change", () => {
            if (cb.checked) {
                allLists.checked = false;
            }
        });
    });

});
</script>
{% endblock %}
