{% extends "base.html" %}

{% block title %}Profil{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/profile.css') }}">
{% endblock %}

{% block content %}

<div class="profile-container">

    <!-- =====================================================
         PROFILE HERO
         ===================================================== -->
    <div class="profile-hero">
        <h1>{{ user.username }}</h1>
        <p>{{ user.email }}</p>
    </div>


    <!-- =====================================================
         STATS OVERVIEW
         ===================================================== -->
    <div class="profile-card">
        <div class="profile-row">
            <span class="profile-label">Ordlistor</span>
            <span class="profile-value">{{ total_lists }}</span>
        </div>

        <div class="profile-row">
            <span class="profile-label">Ord totalt</span>
            <span class="profile-value">{{ total_words }}</span>
        </div>

        <div class="profile-row">
            <span class="profile-label">Genomförda förhör</span>
            <span class="profile-value">{{ total_quizzes }}</span>
        </div>
    </div>


    <!-- =====================================================
         QUIZ HISTORY
         ===================================================== -->
    <div class="profile-card">
        <h3>Resultat över tid</h3>

        {% if quiz_scores and quiz_scores|length > 0 %}
            <canvas id="quizChart" height="120"></canvas>
        {% else %}
            <p class="stats-empty">Inga resultat ännu.</p>
        {% endif %}
    </div>


    <!-- =====================================================
         HARDEST WORDS
         ===================================================== -->
    <div class="profile-card">
        <h3>Svåraste orden</h3>

        {% if hardest_words and hardest_words|length > 0 %}
            <div class="table-responsive">
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Ord</th>
                            <th>Rätt</th>
                            <th>Fel</th>
                            <th>Senast fel</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for word in hardest_words %}
                        <tr>
                            <td>{{ word.original }}</td>
                            <td>{{ word.correct_count or 0 }}</td>
                            <td>{{ word.wrong_count or 0 }}</td>
                            <td>
                                {% if word.last_wrong %}
                                    {{ word.last_wrong.strftime("%Y-%m-%d") }}
                                {% else %}
                                    –
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="stats-empty">Du har ännu inga misslyckade ord.</p>
        {% endif %}
    </div>


    <!-- =====================================================
         ACTIONS
         ===================================================== -->
    <div class="profile-card">
        <h3>Konto</h3>

        <div class="profile-actions">
            <a href="{{ url_for('settings.settings') }}" class="profile-btn primary">
                Inställningar
            </a>

            <a href="{{ url_for('auth.logout') }}" class="profile-btn">
                Logga ut
            </a>
        </div>
    </div>


    <!-- =====================================================
         DANGER ZONE
         ===================================================== -->
    <div class="profile-danger">
        <h3>Riskzon</h3>
        <p>Denna åtgärd kan inte ångras.</p>

        <button class="profile-btn" type="button" disabled>
            Radera konto (kommer snart)
        </button>
    </div>

</div>


<!-- =====================================================
     CHART.JS
     ===================================================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% if quiz_scores and quiz_scores|length > 0 %}
<script>
const ctx = document.getElementById("quizChart");

new Chart(ctx, {
    type: "line",
    data: {
        labels: {{ quiz_labels | tojson }},
        datasets: [{
            data: {{ quiz_scores | tojson }},
            borderWidth: 3,
            tension: 0.35,
            borderColor: getComputedStyle(document.documentElement)
                .getPropertyValue("--color-primary-600"),
            pointRadius: 4,
            pointHoverRadius: 6,
            fill: false
        }]
    },
    options: {
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>
{% endif %}

{% endblock %}
